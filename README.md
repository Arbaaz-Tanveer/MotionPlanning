# Motion Planning for RoboCup MSL Robots
This repository is built on top of https://github.com/debrajk22/MotionPlanning
This repository includes the Motion planning codebase of a RoboCup MSL Robot using a 4-wheel omni-drive for Team ERA IITK.

## üìÅ Workspace Structure

This workspace is organized into the following main packages:

- **o1**: Contains the core C++ nodes for motion planning (`main1`) and control (`controller1`)
- **simulation_pkg**: Contains the Python-based robot simulator (`bot_simulation`), target publishing GUI (`target_gui`), and a keyboard controller
- **Launch Files**: A launch file is used to run the entire system

## üìã Requirements

- OpenCV v4.8.1 (C++ Version)
- OMPL v1.6 (C++ Version, python bindings are not required)
- cmake
- Boost
- Eigen
- ROS 2 Jazzy Jalisco/Humble
- rqt (or other Python GUI libraries like Tkinter/PyQt for the GUI)
- Pygame (for simulation_pkg)
- PyYAML
- numpy

## üîß Installation

### Install System Dependencies

```bash
sudo apt update && sudo apt upgrade
sudo apt install libopencv-dev
sudo apt install libboost-all-dev
sudo apt install libompl-dev ompl-demos
sudo apt-get install libeigen3-dev
sudo apt install ros-jazzy-rqt-py  # Or other dependencies for your GUI
pip install pygame
pip install pyserial
```

### Install OMPL

Download the OMPL installation script from https://ompl.kavrakilab.org/install-ompl-ubuntu.sh and run:

```bash
chmod u+x install-ompl-ubuntu.sh
./install-ompl-ubuntu.sh
```

### Install Acado

```bash
git clone https://github.com/acado/acado.git
cd acado
mkdir build
cd build
cmake ..
make
sudo make install
export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
```

## üöÄ How to Run the System

This repository is set up to be launched from a single main launch file.

### 1. Build All Packages

From the root of your ROS 2 workspace:

```bash
colcon build
source install/local_setup.bash
```

### 2. Launch the System

This command will start all the necessary nodes: the path planner, controller, simulation, and the GUI.

```bash
ros2 launch simulation_pkg simulation.launch.py
```

This will run `bot_simulation`, `target_gui`, `controller1`, and `main1`.

### 3. Send a Target Goal

Once the system is running, you need to provide a goal to the `o1/decision_target_data` topic. You can do this in two ways:

#### Option 1: Using the GUI (target_gui)

The launch file automatically starts the `target_gui` node. Use the input fields in the GUI window or click in the window at a position to enter the desired X, Y, and Theta coordinates, then press the "Send" button.

#### Option 2: Using the Terminal (Manual)

You can also publish the target point manually from a new terminal:

```bash
ros2 topic pub o1/decision_target_data std_msgs/msg/Float32MultiArray "{data: [0.0, 0.0, 0.0]}"
```

*(Remember to change the `[0.0, 0.0, 0.0]` array to your desired `[x, y, theta]` values.)*

### 4. Enable Dribbling Constraints

To turn on dribbling constraints in the MPC controller, use the following command:

```bash
ros2 ros2 topic pub /dribbling_flag std_msgs/msg/Bool "{data: true}"
```
Set data: false to disable dribbling constraints.

## üì¶ Package Descriptions

### o1 Package

#### Path Planner (main1)

**Description**: This C++ node plans the path using OMPL. It takes the current states of the robot and the obstacle and a target state

#### MPC Controller (controller1)

**Description**: This C++ node implements the Model Predictive Controller (MPC) to follow the path generated by the `main1` (path_planner).This include a approx real model of the robot being used, and all the kinematics relations between global velocities and the wheel velocities and the constraint on the speed and torque on them.

### simulation_pkg Package

#### Python Simulation (bot_simulation)

**Description**: A simple Python-based simulator using Pygame.

#### GUI Publisher (target_gui)

**Description**: A simple GUI that provides text boxes and a button to easily publish target goals (`{x, y, theta}`) to the `/o1/decision_target_data` topic. This is automatically launched with the main launch file.

#### Keyboard Controller

**Description**: A controller to control the other static bots using keyboard.

To run the keyboard controller - 
```bash
ros2 run simulation_pkg keyboard_controller"
```


---

